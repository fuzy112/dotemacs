;;; rust-docs.el --- Quick access to rust-docs -*- lexical-binding: t -*-
;; Copyright Â© 2024  Zhengyi Fu <i@fuzy.me>

;; Author:   Zhengyi Fu <i@fuzy.me>
;; Version: 0.1.4
;; Keywords: doc

;;; Commentary:

;; This file provides some simple commands that facilitates opening
;; rust-docs quickly in Emacs.

;;; Code:

(require 'shr)
(require 'compat nil t)

(defgroup rust-docs ()
  "Rust-docs."
  :group 'docs
  :prefix "rust-docs-")

(defconst rust-docs-topics
  '("alloc::AllocError"
    "std::alloc::Global"
    "std::alloc::Layout"
    "std::alloc::LayoutError"
    "std::alloc::System"
    "std::any::TypeId"
    "std::array::IntoIter"
    "std::array::TryFromSliceError"
    "std::ascii::EscapeDefault"
    "std::async_iter::FromIter"
    "std::backtrace::Backtrace"
    "std::backtrace::BacktraceFrame"
    "std::boxed::Box"
    "std::boxed::ThinBox"
    "std::cell::BorrowError"
    "std::cell::BorrowMutError"
    "std::cell::Cell"
    "std::cell::LazyCell"
    "std::cell::OnceCell"
    "std::cell::Ref"
    "std::cell::RefCell"
    "std::cell::RefMut"
    "std::cell::SyncUnsafeCell"
    "std::cell::UnsafeCell"
    "std::char::CharTryFromError"
    "std::char::DecodeUtf16"
    "std::char::DecodeUtf16Error"
    "std::char::EscapeDebug"
    "std::char::EscapeDefault"
    "std::char::EscapeUnicode"
    "std::char::ParseCharError"
    "std::char::ToLowercase"
    "std::char::ToUppercase"
    "std::char::TryFromCharError"
    "std::cmp::Reverse"
    "std::collections::BTreeMap"
    "std::collections::BTreeSet"
    "std::collections::BinaryHeap"
    "std::collections::HashMap"
    "std::collections::HashSet"
    "std::collections::LinkedList"
    "std::collections::TryReserveError"
    "std::collections::VecDeque"
    "std::collections::binary_heap::BinaryHeap"
    "std::collections::binary_heap::Drain"
    "std::collections::binary_heap::DrainSorted"
    "std::collections::binary_heap::IntoIter"
    "std::collections::binary_heap::IntoIterSorted"
    "std::collections::binary_heap::Iter"
    "std::collections::binary_heap::PeekMut"
    "std::collections::btree_map::BTreeMap"
    "std::collections::btree_map::Cursor"
    "std::collections::btree_map::CursorMut"
    "std::collections::btree_map::CursorMutKey"
    "std::collections::btree_map::ExtractIf"
    "std::collections::btree_map::IntoIter"
    "std::collections::btree_map::IntoKeys"
    "std::collections::btree_map::IntoValues"
    "std::collections::btree_map::Iter"
    "std::collections::btree_map::IterMut"
    "std::collections::btree_map::Keys"
    "std::collections::btree_map::OccupiedEntry"
    "std::collections::btree_map::OccupiedError"
    "std::collections::btree_map::Range"
    "std::collections::btree_map::RangeMut"
    "std::collections::btree_map::UnorderedKeyError"
    "std::collections::btree_map::VacantEntry"
    "std::collections::btree_map::Values"
    "std::collections::btree_map::ValuesMut"
    "std::collections::btree_set::BTreeSet"
    "std::collections::btree_set::Difference"
    "std::collections::btree_set::ExtractIf"
    "std::collections::btree_set::Intersection"
    "std::collections::btree_set::IntoIter"
    "std::collections::btree_set::Iter"
    "std::collections::btree_set::Range"
    "std::collections::btree_set::SymmetricDifference"
    "std::collections::btree_set::Union"
    "std::collections::hash_map::DefaultHasher"
    "std::collections::hash_map::Drain"
    "std::collections::hash_map::ExtractIf"
    "std::collections::hash_map::HashMap"
    "std::collections::hash_map::IntoIter"
    "std::collections::hash_map::IntoKeys"
    "std::collections::hash_map::IntoValues"
    "std::collections::hash_map::Iter"
    "std::collections::hash_map::IterMut"
    "std::collections::hash_map::Keys"
    "std::collections::hash_map::OccupiedEntry"
    "std::collections::hash_map::OccupiedError"
    "std::collections::hash_map::RandomState"
    "std::collections::hash_map::RawEntryBuilder"
    "std::collections::hash_map::RawEntryBuilderMut"
    "std::collections::hash_map::RawOccupiedEntryMut"
    "std::collections::hash_map::RawVacantEntryMut"
    "std::collections::hash_map::VacantEntry"
    "std::collections::hash_map::Values"
    "std::collections::hash_map::ValuesMut"
    "std::collections::hash_set::Difference"
    "std::collections::hash_set::Drain"
    "std::collections::hash_set::ExtractIf"
    "std::collections::hash_set::HashSet"
    "std::collections::hash_set::Intersection"
    "std::collections::hash_set::IntoIter"
    "std::collections::hash_set::Iter"
    "std::collections::hash_set::SymmetricDifference"
    "std::collections::hash_set::Union"
    "std::collections::linked_list::Cursor"
    "std::collections::linked_list::CursorMut"
    "std::collections::linked_list::ExtractIf"
    "std::collections::linked_list::IntoIter"
    "std::collections::linked_list::Iter"
    "std::collections::linked_list::IterMut"
    "std::collections::linked_list::LinkedList"
    "std::collections::vec_deque::Drain"
    "std::collections::vec_deque::IntoIter"
    "std::collections::vec_deque::Iter"
    "std::collections::vec_deque::IterMut"
    "std::collections::vec_deque::VecDeque"
    "std::env::Args"
    "std::env::ArgsOs"
    "std::env::JoinPathsError"
    "std::env::SplitPaths"
    "std::env::Vars"
    "std::env::VarsOs"
    "std::error::Report"
    "std::error::Request"
    "std::ffi::CStr"
    "std::ffi::CString"
    "std::ffi::OsStr"
    "std::ffi::OsString"
    "std::ffi::VaList"
    "std::ffi::VaListImpl"
    "std::ffi::c_str::CStr"
    "std::ffi::c_str::CString"
    "std::ffi::c_str::FromBytesUntilNulError"
    "std::ffi::c_str::FromBytesWithNulError"
    "std::ffi::c_str::FromVecWithNulError"
    "std::ffi::c_str::IntoStringError"
    "std::ffi::c_str::NulError"
    "std::ffi::os_str::Display"
    "std::ffi::os_str::OsStr"
    "std::ffi::os_str::OsString"
    "std::fmt::Arguments"
    "std::fmt::DebugList"
    "std::fmt::DebugMap"
    "std::fmt::DebugSet"
    "std::fmt::DebugStruct"
    "std::fmt::DebugTuple"
    "std::fmt::Error"
    "std::fmt::Formatter"
    "std::fmt::FormatterFn"
    "std::fs::DirBuilder"
    "std::fs::DirEntry"
    "std::fs::File"
    "std::fs::FileTimes"
    "std::fs::FileType"
    "std::fs::Metadata"
    "std::fs::OpenOptions"
    "std::fs::Permissions"
    "std::fs::ReadDir"
    "std::future::AsyncDropInPlace"
    "std::future::Pending"
    "std::future::PollFn"
    "std::future::Ready"
    "std::hash::BuildHasherDefault"
    "std::hash::DefaultHasher"
    "std::hash::RandomState"
    "std::hash::SipHasher"
    "std::intrinsics::mir::ReturnToArg"
    "std::intrinsics::mir::UnwindActionArg"
    "std::io::BorrowedBuf"
    "std::io::BorrowedCursor"
    "std::io::BufReader"
    "std::io::BufWriter"
    "std::io::Bytes"
    "std::io::Chain"
    "std::io::Cursor"
    "std::io::Empty"
    "std::io::Error"
    "std::io::IntoInnerError"
    "std::io::IoSlice"
    "std::io::IoSliceMut"
    "std::io::LineWriter"
    "std::io::Lines"
    "std::io::Repeat"
    "std::io::Sink"
    "std::io::Split"
    "std::io::Stderr"
    "std::io::StderrLock"
    "std::io::Stdin"
    "std::io::StdinLock"
    "std::io::Stdout"
    "std::io::StdoutLock"
    "std::io::Take"
    "std::io::WriterPanicked"
    "std::iter::ArrayChunks"
    "std::iter::ByRefSized"
    "std::iter::Chain"
    "std::iter::Cloned"
    "std::iter::Copied"
    "std::iter::Cycle"
    "std::iter::Empty"
    "std::iter::Enumerate"
    "std::iter::Filter"
    "std::iter::FilterMap"
    "std::iter::FlatMap"
    "std::iter::Flatten"
    "std::iter::FromFn"
    "std::iter::Fuse"
    "std::iter::Inspect"
    "std::iter::Intersperse"
    "std::iter::IntersperseWith"
    "std::iter::Map"
    "std::iter::MapWhile"
    "std::iter::MapWindows"
    "std::iter::Once"
    "std::iter::OnceWith"
    "std::iter::Peekable"
    "std::iter::Repeat"
    "std::iter::RepeatN"
    "std::iter::RepeatWith"
    "std::iter::Rev"
    "std::iter::Scan"
    "std::iter::Skip"
    "std::iter::SkipWhile"
    "std::iter::StepBy"
    "std::iter::Successors"
    "std::iter::Take"
    "std::iter::TakeWhile"
    "std::iter::Zip"
    "std::marker::PhantomData"
    "std::marker::PhantomPinned"
    "std::mem::Assume"
    "std::mem::Discriminant"
    "std::mem::ManuallyDrop"
    "std::net::AddrParseError"
    "std::net::Incoming"
    "std::net::IntoIncoming"
    "std::net::Ipv4Addr"
    "std::net::Ipv6Addr"
    "std::net::SocketAddrV4"
    "std::net::SocketAddrV6"
    "std::net::TcpListener"
    "std::net::TcpStream"
    "std::net::UdpSocket"
    "std::num::NonZero"
    "std::num::ParseFloatError"
    "std::num::ParseIntError"
    "std::num::Saturating"
    "std::num::TryFromIntError"
    "std::num::Wrapping"
    "std::ops::Range"
    "std::ops::RangeFrom"
    "std::ops::RangeFull"
    "std::ops::RangeInclusive"
    "std::ops::RangeTo"
    "std::ops::RangeToInclusive"
    "std::ops::Yeet"
    "std::option::IntoIter"
    "std::option::Iter"
    "std::option::IterMut"
    "std::os::fd::BorrowedFd"
    "std::os::fd::OwnedFd"
    "std::os::linux::process::PidFd"
    "std::os::linux::raw::stat"
    "std::os::unix::net::Incoming"
    "std::os::unix::net::Messages"
    "std::os::unix::net::ScmCredentials"
    "std::os::unix::net::ScmRights"
    "std::os::unix::net::SocketAddr"
    "std::os::unix::net::SocketAncillary"
    "std::os::unix::net::SocketCred"
    "std::os::unix::net::UnixDatagram"
    "std::os::unix::net::UnixListener"
    "std::os::unix::net::UnixStream"
    "std::os::windows::ffi::EncodeWide"
    "std::os::windows::io::BorrowedHandle"
    "std::os::windows::io::BorrowedSocket"
    "std::os::windows::io::HandleOrInvalid"
    "std::os::windows::io::HandleOrNull"
    "std::os::windows::io::InvalidHandleError"
    "std::os::windows::io::NullHandleError"
    "std::os::windows::io::OwnedHandle"
    "std::os::windows::io::OwnedSocket"
    "std::panic::AssertUnwindSafe"
    "std::panic::Location"
    "std::panic::PanicInfo"
    "std::path::Ancestors"
    "std::path::Components"
    "std::path::Display"
    "std::path::Iter"
    "std::path::Path"
    "std::path::PathBuf"
    "std::path::PrefixComponent"
    "std::path::StripPrefixError"
    "std::pin::Pin"
    "std::process::Child"
    "std::process::ChildStderr"
    "std::process::ChildStdin"
    "std::process::ChildStdout"
    "std::process::Command"
    "std::process::CommandArgs"
    "std::process::CommandEnvs"
    "std::process::ExitCode"
    "std::process::ExitStatus"
    "std::process::ExitStatusError"
    "std::process::Output"
    "std::process::Stdio"
    "std::ptr::Alignment"
    "std::ptr::DynMetadata"
    "std::ptr::NonNull"
    "std::rc::Rc"
    "std::rc::UniqueRc"
    "std::rc::Weak"
    "std::result::IntoIter"
    "std::result::Iter"
    "std::result::IterMut"
    "std::simd::LaneCount"
    "std::simd::Mask"
    "std::simd::Simd"
    "std::simd::prelude::Mask"
    "std::simd::prelude::Simd"
    "std::slice::ArrayChunks"
    "std::slice::ArrayChunksMut"
    "std::slice::ArrayWindows"
    "std::slice::ChunkBy"
    "std::slice::ChunkByMut"
    "std::slice::Chunks"
    "std::slice::ChunksExact"
    "std::slice::ChunksExactMut"
    "std::slice::ChunksMut"
    "std::slice::EscapeAscii"
    "std::slice::Iter"
    "std::slice::IterMut"
    "std::slice::RChunks"
    "std::slice::RChunksExact"
    "std::slice::RChunksExactMut"
    "std::slice::RChunksMut"
    "std::slice::RSplit"
    "std::slice::RSplitMut"
    "std::slice::RSplitN"
    "std::slice::RSplitNMut"
    "std::slice::Split"
    "std::slice::SplitInclusive"
    "std::slice::SplitInclusiveMut"
    "std::slice::SplitMut"
    "std::slice::SplitN"
    "std::slice::SplitNMut"
    "std::slice::Windows"
    "std::str::Bytes"
    "std::str::CharIndices"
    "std::str::Chars"
    "std::str::EncodeUtf16"
    "std::str::EscapeDebug"
    "std::str::EscapeDefault"
    "std::str::EscapeUnicode"
    "std::str::Lines"
    "std::str::LinesAny"
    "std::str::MatchIndices"
    "std::str::Matches"
    "std::str::ParseBoolError"
    "std::str::RMatchIndices"
    "std::str::RMatches"
    "std::str::RSplit"
    "std::str::RSplitN"
    "std::str::RSplitTerminator"
    "std::str::Split"
    "std::str::SplitAsciiWhitespace"
    "std::str::SplitInclusive"
    "std::str::SplitN"
    "std::str::SplitTerminator"
    "std::str::SplitWhitespace"
    "std::str::Utf8Chunk"
    "std::str::Utf8Chunks"
    "std::str::Utf8Error"
    "std::str::pattern::CharArrayRefSearcher"
    "std::str::pattern::CharArraySearcher"
    "std::str::pattern::CharPredicateSearcher"
    "std::str::pattern::CharSearcher"
    "std::str::pattern::CharSliceSearcher"
    "std::str::pattern::StrSearcher"
    "std::string::Drain"
    "std::string::FromUtf16Error"
    "std::string::FromUtf8Error"
    "std::string::String"
    "std::sync::Arc"
    "std::sync::Barrier"
    "std::sync::BarrierWaitResult"
    "std::sync::Condvar"
    "std::sync::Exclusive"
    "std::sync::LazyLock"
    "std::sync::MappedMutexGuard"
    "std::sync::MappedRwLockReadGuard"
    "std::sync::MappedRwLockWriteGuard"
    "std::sync::Mutex"
    "std::sync::MutexGuard"
    "std::sync::Once"
    "std::sync::OnceLock"
    "std::sync::OnceState"
    "std::sync::PoisonError"
    "std::sync::ReentrantLock"
    "std::sync::ReentrantLockGuard"
    "std::sync::RwLock"
    "std::sync::RwLockReadGuard"
    "std::sync::RwLockWriteGuard"
    "std::sync::WaitTimeoutResult"
    "std::sync::Weak"
    "std::sync::atomic::AtomicBool"
    "std::sync::atomic::AtomicI128"
    "std::sync::atomic::AtomicI16"
    "std::sync::atomic::AtomicI32"
    "std::sync::atomic::AtomicI64"
    "std::sync::atomic::AtomicI8"
    "std::sync::atomic::AtomicIsize"
    "std::sync::atomic::AtomicPtr"
    "std::sync::atomic::AtomicU128"
    "std::sync::atomic::AtomicU16"
    "std::sync::atomic::AtomicU32"
    "std::sync::atomic::AtomicU64"
    "std::sync::atomic::AtomicU8"
    "std::sync::atomic::AtomicUsize"
    "std::sync::mpsc::IntoIter"
    "std::sync::mpsc::Iter"
    "std::sync::mpsc::Receiver"
    "std::sync::mpsc::RecvError"
    "std::sync::mpsc::SendError"
    "std::sync::mpsc::Sender"
    "std::sync::mpsc::SyncSender"
    "std::sync::mpsc::TryIter"
    "std::task::Context"
    "std::task::ContextBuilder"
    "std::task::LocalWaker"
    "std::task::RawWaker"
    "std::task::RawWakerVTable"
    "std::task::Waker"
    "std::thread::AccessError"
    "std::thread::Builder"
    "std::thread::JoinHandle"
    "std::thread::LocalKey"
    "std::thread::Scope"
    "std::thread::ScopedJoinHandle"
    "std::thread::Thread"
    "std::thread::ThreadId"
    "std::time::Duration"
    "std::time::Instant"
    "std::time::SystemTime"
    "std::time::SystemTimeError"
    "std::time::TryFromFloatSecsError"
    "std::vec::Drain"
    "std::vec::ExtractIf"
    "std::vec::IntoIter"
    "std::vec::Splice"
    "std::vec::Vec"
    "std::ascii::Char"
    "std::backtrace::BacktraceStatus"
    "std::borrow::Cow"
    "std::cmp::Ordering"
    "std::collections::TryReserveErrorKind"
    "std::collections::btree_map::Entry"
    "std::collections::hash_map::Entry"
    "std::collections::hash_map::RawEntryMut"
    "std::convert::Infallible"
    "std::env::VarError"
    "std::ffi::c_void"
    "std::fmt::Alignment"
    "std::intrinsics::mir::BasicBlock"
    "std::intrinsics::mir::UnwindTerminateReason"
    "std::io::ErrorKind"
    "std::io::SeekFrom"
    "std::net::IpAddr"
    "std::net::Ipv6MulticastScope"
    "std::net::Shutdown"
    "std::net::SocketAddr"
    "std::num::FpCategory"
    "std::num::IntErrorKind"
    "std::ops::Bound"
    "std::ops::ControlFlow"
    "std::ops::CoroutineState"
    "std::option::Option"
    "std::os::unix::net::AncillaryData"
    "std::os::unix::net::AncillaryError"
    "std::panic::BacktraceStyle"
    "std::path::Component"
    "std::path::Prefix"
    "std::result::Result"
    "std::str::pattern::SearchStep"
    "std::sync::TryLockError"
    "std::sync::atomic::Ordering"
    "std::sync::mpsc::RecvTimeoutError"
    "std::sync::mpsc::TryRecvError"
    "std::sync::mpsc::TrySendError"
    "std::task::Poll"
    "std::mem::MaybeUninit"
    "std::array"
    "std::bool"
    "std::char"
    "std::f128"
    "std::f16"
    "std::f32"
    "std::f64"
    "std::fn"
    "std::i128"
    "std::i16"
    "std::i32"
    "std::i64"
    "std::i8"
    "std::isize"
    "std::never"
    "std::pointer"
    "std::reference"
    "std::slice"
    "std::str"
    "std::tuple"
    "std::u128"
    "std::u16"
    "std::u32"
    "std::u64"
    "std::u8"
    "std::unit"
    "std::usize"
    "std::alloc::Allocator"
    "std::alloc::GlobalAlloc"
    "std::any::Any"
    "std::ascii::AsciiExt"
    "std::async_iter::AsyncIterator"
    "std::async_iter::IntoAsyncIterator"
    "std::borrow::Borrow"
    "std::borrow::BorrowMut"
    "std::borrow::ToOwned"
    "std::clone::Clone"
    "std::cmp::Eq"
    "std::cmp::Ord"
    "std::cmp::PartialEq"
    "std::cmp::PartialOrd"
    "std::convert::AsMut"
    "std::convert::AsRef"
    "std::convert::FloatToInt"
    "std::convert::From"
    "std::convert::Into"
    "std::convert::TryFrom"
    "std::convert::TryInto"
    "std::default::Default"
    "std::error::Error"
    "std::fmt::Binary"
    "std::fmt::Debug"
    "std::fmt::Display"
    "std::fmt::LowerExp"
    "std::fmt::LowerHex"
    "std::fmt::Octal"
    "std::fmt::Pointer"
    "std::fmt::UpperExp"
    "std::fmt::UpperHex"
    "std::fmt::Write"
    "std::future::AsyncDrop"
    "std::future::Future"
    "std::future::IntoFuture"
    "std::hash::BuildHasher"
    "std::hash::Hash"
    "std::hash::Hasher"
    "std::intrinsics::AggregateRawPtr"
    "std::io::BufRead"
    "std::io::IsTerminal"
    "std::io::Read"
    "std::io::Seek"
    "std::io::Write"
    "std::iter::DoubleEndedIterator"
    "std::iter::ExactSizeIterator"
    "std::iter::Extend"
    "std::iter::FromIterator"
    "std::iter::FusedIterator"
    "std::iter::IntoIterator"
    "std::iter::Iterator"
    "std::iter::Product"
    "std::iter::Step"
    "std::iter::Sum"
    "std::iter::TrustedLen"
    "std::iter::TrustedStep"
    "std::marker::ConstParamTy"
    "std::marker::Copy"
    "std::marker::Destruct"
    "std::marker::DiscriminantKind"
    "std::marker::FnPtr"
    "std::marker::Freeze"
    "std::marker::PointerLike"
    "std::marker::Send"
    "std::marker::Sized"
    "std::marker::StructuralPartialEq"
    "std::marker::Sync"
    "std::marker::Tuple"
    "std::marker::Unpin"
    "std::marker::Unsize"
    "std::mem::BikeshedIntrinsicFrom"
    "std::net::ToSocketAddrs"
    "std::num::ZeroablePrimitive"
    "std::ops::Add"
    "std::ops::AddAssign"
    "std::ops::AsyncFn"
    "std::ops::AsyncFnMut"
    "std::ops::AsyncFnOnce"
    "std::ops::BitAnd"
    "std::ops::BitAndAssign"
    "std::ops::BitOr"
    "std::ops::BitOrAssign"
    "std::ops::BitXor"
    "std::ops::BitXorAssign"
    "std::ops::CoerceUnsized"
    "std::ops::Coroutine"
    "std::ops::Deref"
    "std::ops::DerefMut"
    "std::ops::DerefPure"
    "std::ops::DispatchFromDyn"
    "std::ops::Div"
    "std::ops::DivAssign"
    "std::ops::Drop"
    "std::ops::Fn"
    "std::ops::FnMut"
    "std::ops::FnOnce"
    "std::ops::FromResidual"
    "std::ops::Index"
    "std::ops::IndexMut"
    "std::ops::Mul"
    "std::ops::MulAssign"
    "std::ops::Neg"
    "std::ops::Not"
    "std::ops::OneSidedRange"
    "std::ops::RangeBounds"
    "std::ops::Rem"
    "std::ops::RemAssign"
    "std::ops::Residual"
    "std::ops::Shl"
    "std::ops::ShlAssign"
    "std::ops::Shr"
    "std::ops::ShrAssign"
    "std::ops::Sub"
    "std::ops::SubAssign"
    "std::ops::Try"
    "std::os::fd::AsFd"
    "std::os::fd::AsRawFd"
    "std::os::fd::FromRawFd"
    "std::os::fd::IntoRawFd"
    "std::os::linux::fs::MetadataExt"
    "std::os::linux::net::SocketAddrExt"
    "std::os::linux::net::TcpStreamExt"
    "std::os::linux::net::UnixSocketExt"
    "std::os::linux::process::ChildExt"
    "std::os::linux::process::CommandExt"
    "std::os::unix::ffi::OsStrExt"
    "std::os::unix::ffi::OsStringExt"
    "std::os::unix::fs::DirBuilderExt"
    "std::os::unix::fs::DirEntryExt"
    "std::os::unix::fs::DirEntryExt2"
    "std::os::unix::fs::FileExt"
    "std::os::unix::fs::FileTypeExt"
    "std::os::unix::fs::MetadataExt"
    "std::os::unix::fs::OpenOptionsExt"
    "std::os::unix::fs::PermissionsExt"
    "std::os::unix::process::CommandExt"
    "std::os::unix::process::ExitStatusExt"
    "std::os::unix::thread::JoinHandleExt"
    "std::os::wasi::ffi::OsStrExt"
    "std::os::wasi::ffi::OsStringExt"
    "std::os::wasi::fs::DirEntryExt"
    "std::os::wasi::fs::FileExt"
    "std::os::wasi::fs::FileTypeExt"
    "std::os::wasi::fs::MetadataExt"
    "std::os::wasi::fs::OpenOptionsExt"
    "std::os::wasi::net::TcpListenerExt"
    "std::os::windows::ffi::OsStrExt"
    "std::os::windows::ffi::OsStringExt"
    "std::os::windows::fs::FileExt"
    "std::os::windows::fs::FileTimesExt"
    "std::os::windows::fs::FileTypeExt"
    "std::os::windows::fs::MetadataExt"
    "std::os::windows::fs::OpenOptionsExt"
    "std::os::windows::io::AsHandle"
    "std::os::windows::io::AsRawHandle"
    "std::os::windows::io::AsRawSocket"
    "std::os::windows::io::AsSocket"
    "std::os::windows::io::FromRawHandle"
    "std::os::windows::io::FromRawSocket"
    "std::os::windows::io::IntoRawHandle"
    "std::os::windows::io::IntoRawSocket"
    "std::os::windows::process::ChildExt"
    "std::os::windows::process::CommandExt"
    "std::os::windows::process::ExitCodeExt"
    "std::os::windows::process::ExitStatusExt"
    "std::panic::RefUnwindSafe"
    "std::panic::UnwindSafe"
    "std::process::Termination"
    "std::ptr::Pointee"
    "std::simd::MaskElement"
    "std::simd::SimdCast"
    "std::simd::SimdElement"
    "std::simd::StdFloat"
    "std::simd::SupportedLaneCount"
    "std::simd::Swizzle"
    "std::simd::ToBytes"
    "std::simd::cmp::SimdOrd"
    "std::simd::cmp::SimdPartialEq"
    "std::simd::cmp::SimdPartialOrd"
    "std::simd::num::SimdFloat"
    "std::simd::num::SimdInt"
    "std::simd::num::SimdUint"
    "std::simd::prelude::SimdConstPtr"
    "std::simd::prelude::SimdFloat"
    "std::simd::prelude::SimdInt"
    "std::simd::prelude::SimdMutPtr"
    "std::simd::prelude::SimdOrd"
    "std::simd::prelude::SimdPartialEq"
    "std::simd::prelude::SimdPartialOrd"
    "std::simd::prelude::SimdUint"
    "std::simd::ptr::SimdConstPtr"
    "std::simd::ptr::SimdMutPtr"
    "std::slice::Concat"
    "std::slice::Join"
    "std::slice::SliceIndex"
    "std::str::FromStr"
    "std::str::pattern::DoubleEndedSearcher"
    "std::str::pattern::Pattern"
    "std::str::pattern::ReverseSearcher"
    "std::str::pattern::Searcher"
    "std::string::ToString"
    "std::task::LocalWake"
    "std::task::Wake"
    "std::arch::is_aarch64_feature_detected"
    "std::arch::is_arm_feature_detected"
    "std::arch::is_mips64_feature_detected"
    "std::arch::is_mips_feature_detected"
    "std::arch::is_powerpc64_feature_detected"
    "std::arch::is_powerpc_feature_detected"
    "std::arch::is_riscv_feature_detected"
    "std::arch::is_x86_feature_detected"
    "std::assert"
    "std::assert_eq"
    "std::assert_matches::assert_matches"
    "std::assert_matches::debug_assert_matches"
    "std::assert_ne"
    "std::cfg"
    "std::cfg_match"
    "std::column"
    "std::compile_error"
    "std::concat"
    "std::concat_bytes"
    "std::concat_idents"
    "std::const_format_args"
    "std::dbg"
    "std::debug_assert"
    "std::debug_assert_eq"
    "std::debug_assert_ne"
    "std::env"
    "std::eprint"
    "std::eprintln"
    "std::file"
    "std::format"
    "std::format_args"
    "std::format_args_nl"
    "std::future::join"
    "std::include"
    "std::include_bytes"
    "std::include_str"
    "std::intrinsics::mir::mir"
    "std::intrinsics::mir::place"
    "std::is_x86_feature_detected"
    "std::line"
    "std::log_syntax"
    "std::matches"
    "std::mem::offset_of"
    "std::module_path"
    "std::option_env"
    "std::panic"
    "std::pat::pattern_type"
    "std::pin::pin"
    "std::prelude::rust_2024::deref"
    "std::prelude::rust_2024::type_ascribe"
    "std::prelude::v1::deref"
    "std::prelude::v1::type_ascribe"
    "std::print"
    "std::println"
    "std::ptr::addr_of"
    "std::ptr::addr_of_mut"
    "std::simd::prelude::simd_swizzle"
    "std::simd::simd_swizzle"
    "std::stringify"
    "std::task::ready"
    "std::thread_local"
    "std::todo"
    "std::trace_macros"
    "std::try"
    "std::unimplemented"
    "std::unreachable"
    "std::vec"
    "std::write"
    "std::writeln"
    "std::prelude::rust_2024::alloc_error_handler"
    "std::prelude::rust_2024::bench"
    "std::prelude::rust_2024::cfg_accessible"
    "std::prelude::rust_2024::cfg_eval"
    "std::prelude::rust_2024::derive"
    "std::prelude::rust_2024::derive_const"
    "std::prelude::rust_2024::global_allocator"
    "std::prelude::rust_2024::test"
    "std::prelude::rust_2024::test_case"
    "std::prelude::v1::alloc_error_handler"
    "std::prelude::v1::bench"
    "std::prelude::v1::cfg_accessible"
    "std::prelude::v1::cfg_eval"
    "std::prelude::v1::derive"
    "std::prelude::v1::derive_const"
    "std::prelude::v1::global_allocator"
    "std::prelude::v1::test"
    "std::prelude::v1::test_case"
    "std::clone::Clone"
    "std::cmp::Eq"
    "std::cmp::Ord"
    "std::cmp::PartialEq"
    "std::cmp::PartialOrd"
    "std::default::Default"
    "std::fmt::Debug"
    "std::hash::Hash"
    "std::marker::ConstParamTy"
    "std::marker::Copy"
    "std::alloc::alloc"
    "std::alloc::alloc_zeroed"
    "std::alloc::dealloc"
    "std::alloc::handle_alloc_error"
    "std::alloc::realloc"
    "std::alloc::set_alloc_error_hook"
    "std::alloc::take_alloc_error_hook"
    "std::any::type_name"
    "std::any::type_name_of_val"
    "std::array::from_fn"
    "std::array::from_mut"
    "std::array::from_ref"
    "std::array::try_from_fn"
    "std::ascii::escape_default"
    "std::async_iter::from_iter"
    "std::char::decode_utf16"
    "std::char::from_digit"
    "std::char::from_u32"
    "std::char::from_u32_unchecked"
    "std::cmp::max"
    "std::cmp::max_by"
    "std::cmp::max_by_key"
    "std::cmp::min"
    "std::cmp::min_by"
    "std::cmp::min_by_key"
    "std::cmp::minmax"
    "std::cmp::minmax_by"
    "std::cmp::minmax_by_key"
    "std::convert::identity"
    "std::env::args"
    "std::env::args_os"
    "std::env::current_dir"
    "std::env::current_exe"
    "std::env::home_dir"
    "std::env::join_paths"
    "std::env::remove_var"
    "std::env::set_current_dir"
    "std::env::set_var"
    "std::env::split_paths"
    "std::env::temp_dir"
    "std::env::var"
    "std::env::var_os"
    "std::env::vars"
    "std::env::vars_os"
    "std::error::request_ref"
    "std::error::request_value"
    "std::fmt::format"
    "std::fmt::write"
    "std::fs::canonicalize"
    "std::fs::copy"
    "std::fs::create_dir"
    "std::fs::create_dir_all"
    "std::fs::hard_link"
    "std::fs::metadata"
    "std::fs::read"
    "std::fs::read_dir"
    "std::fs::read_link"
    "std::fs::read_to_string"
    "std::fs::remove_dir"
    "std::fs::remove_dir_all"
    "std::fs::remove_file"
    "std::fs::rename"
    "std::fs::set_permissions"
    "std::fs::soft_link"
    "std::fs::symlink_metadata"
    "std::fs::try_exists"
    "std::fs::write"
    "std::future::async_drop"
    "std::future::async_drop_in_place"
    "std::future::pending"
    "std::future::poll_fn"
    "std::future::ready"
    "std::hint::assert_unchecked"
    "std::hint::black_box"
    "std::hint::must_use"
    "std::hint::spin_loop"
    "std::hint::unreachable_unchecked"
    "std::intrinsics::abort"
    "std::intrinsics::add_with_overflow"
    "std::intrinsics::aggregate_raw_ptr"
    "std::intrinsics::arith_offset"
    "std::intrinsics::assert_inhabited"
    "std::intrinsics::assert_mem_uninitialized_valid"
    "std::intrinsics::assert_zero_valid"
    "std::intrinsics::assume"
    "std::intrinsics::atomic_and_acqrel"
    "std::intrinsics::atomic_and_acquire"
    "std::intrinsics::atomic_and_relaxed"
    "std::intrinsics::atomic_and_release"
    "std::intrinsics::atomic_and_seqcst"
    "std::intrinsics::atomic_cxchg_acqrel_acquire"
    "std::intrinsics::atomic_cxchg_acqrel_relaxed"
    "std::intrinsics::atomic_cxchg_acqrel_seqcst"
    "std::intrinsics::atomic_cxchg_acquire_acquire"
    "std::intrinsics::atomic_cxchg_acquire_relaxed"
    "std::intrinsics::atomic_cxchg_acquire_seqcst"
    "std::intrinsics::atomic_cxchg_relaxed_acquire"
    "std::intrinsics::atomic_cxchg_relaxed_relaxed"
    "std::intrinsics::atomic_cxchg_relaxed_seqcst"
    "std::intrinsics::atomic_cxchg_release_acquire"
    "std::intrinsics::atomic_cxchg_release_relaxed"
    "std::intrinsics::atomic_cxchg_release_seqcst"
    "std::intrinsics::atomic_cxchg_seqcst_acquire"
    "std::intrinsics::atomic_cxchg_seqcst_relaxed"
    "std::intrinsics::atomic_cxchg_seqcst_seqcst"
    "std::intrinsics::atomic_cxchgweak_acqrel_acquire"
    "std::intrinsics::atomic_cxchgweak_acqrel_relaxed"
    "std::intrinsics::atomic_cxchgweak_acqrel_seqcst"
    "std::intrinsics::atomic_cxchgweak_acquire_acquire"
    "std::intrinsics::atomic_cxchgweak_acquire_relaxed"
    "std::intrinsics::atomic_cxchgweak_acquire_seqcst"
    "std::intrinsics::atomic_cxchgweak_relaxed_acquire"
    "std::intrinsics::atomic_cxchgweak_relaxed_relaxed"
    "std::intrinsics::atomic_cxchgweak_relaxed_seqcst"
    "std::intrinsics::atomic_cxchgweak_release_acquire"
    "std::intrinsics::atomic_cxchgweak_release_relaxed"
    "std::intrinsics::atomic_cxchgweak_release_seqcst"
    "std::intrinsics::atomic_cxchgweak_seqcst_acquire"
    "std::intrinsics::atomic_cxchgweak_seqcst_relaxed"
    "std::intrinsics::atomic_cxchgweak_seqcst_seqcst"
    "std::intrinsics::atomic_fence_acqrel"
    "std::intrinsics::atomic_fence_acquire"
    "std::intrinsics::atomic_fence_release"
    "std::intrinsics::atomic_fence_seqcst"
    "std::intrinsics::atomic_load_acquire"
    "std::intrinsics::atomic_load_relaxed"
    "std::intrinsics::atomic_load_seqcst"
    "std::intrinsics::atomic_load_unordered"
    "std::intrinsics::atomic_max_acqrel"
    "std::intrinsics::atomic_max_acquire"
    "std::intrinsics::atomic_max_relaxed"
    "std::intrinsics::atomic_max_release"
    "std::intrinsics::atomic_max_seqcst"
    "std::intrinsics::atomic_min_acqrel"
    "std::intrinsics::atomic_min_acquire"
    "std::intrinsics::atomic_min_relaxed"
    "std::intrinsics::atomic_min_release"
    "std::intrinsics::atomic_min_seqcst"
    "std::intrinsics::atomic_nand_acqrel"
    "std::intrinsics::atomic_nand_acquire"
    "std::intrinsics::atomic_nand_relaxed"
    "std::intrinsics::atomic_nand_release"
    "std::intrinsics::atomic_nand_seqcst"
    "std::intrinsics::atomic_or_acqrel"
    "std::intrinsics::atomic_or_acquire"
    "std::intrinsics::atomic_or_relaxed"
    "std::intrinsics::atomic_or_release"
    "std::intrinsics::atomic_or_seqcst"
    "std::intrinsics::atomic_singlethreadfence_acqrel"
    "std::intrinsics::atomic_singlethreadfence_acquire"
    "std::intrinsics::atomic_singlethreadfence_release"
    "std::intrinsics::atomic_singlethreadfence_seqcst"
    "std::intrinsics::atomic_store_relaxed"
    "std::intrinsics::atomic_store_release"
    "std::intrinsics::atomic_store_seqcst"
    "std::intrinsics::atomic_store_unordered"
    "std::intrinsics::atomic_umax_acqrel"
    "std::intrinsics::atomic_umax_acquire"
    "std::intrinsics::atomic_umax_relaxed"
    "std::intrinsics::atomic_umax_release"
    "std::intrinsics::atomic_umax_seqcst"
    "std::intrinsics::atomic_umin_acqrel"
    "std::intrinsics::atomic_umin_acquire"
    "std::intrinsics::atomic_umin_relaxed"
    "std::intrinsics::atomic_umin_release"
    "std::intrinsics::atomic_umin_seqcst"
    "std::intrinsics::atomic_xadd_acqrel"
    "std::intrinsics::atomic_xadd_acquire"
    "std::intrinsics::atomic_xadd_relaxed"
    "std::intrinsics::atomic_xadd_release"
    "std::intrinsics::atomic_xadd_seqcst"
    "std::intrinsics::atomic_xchg_acqrel"
    "std::intrinsics::atomic_xchg_acquire"
    "std::intrinsics::atomic_xchg_relaxed"
    "std::intrinsics::atomic_xchg_release"
    "std::intrinsics::atomic_xchg_seqcst"
    "std::intrinsics::atomic_xor_acqrel"
    "std::intrinsics::atomic_xor_acquire"
    "std::intrinsics::atomic_xor_relaxed"
    "std::intrinsics::atomic_xor_release"
    "std::intrinsics::atomic_xor_seqcst"
    "std::intrinsics::atomic_xsub_acqrel"
    "std::intrinsics::atomic_xsub_acquire"
    "std::intrinsics::atomic_xsub_relaxed"
    "std::intrinsics::atomic_xsub_release"
    "std::intrinsics::atomic_xsub_seqcst"
    "std::intrinsics::bitreverse"
    "std::intrinsics::black_box"
    "std::intrinsics::breakpoint"
    "std::intrinsics::bswap"
    "std::intrinsics::caller_location"
    "std::intrinsics::catch_unwind"
    "std::intrinsics::ceilf32"
    "std::intrinsics::ceilf64"
    "std::intrinsics::compare_bytes"
    "std::intrinsics::const_allocate"
    "std::intrinsics::const_deallocate"
    "std::intrinsics::const_eval_select"
    "std::intrinsics::copy"
    "std::intrinsics::copy_nonoverlapping"
    "std::intrinsics::copysignf32"
    "std::intrinsics::copysignf64"
    "std::intrinsics::cosf32"
    "std::intrinsics::cosf64"
    "std::intrinsics::ctlz"
    "std::intrinsics::ctlz_nonzero"
    "std::intrinsics::ctpop"
    "std::intrinsics::cttz"
    "std::intrinsics::cttz_nonzero"
    "std::intrinsics::discriminant_value"
    "std::intrinsics::drop_in_place"
    "std::intrinsics::exact_div"
    "std::intrinsics::exp2f32"
    "std::intrinsics::exp2f64"
    "std::intrinsics::expf32"
    "std::intrinsics::expf64"
    "std::intrinsics::fabsf32"
    "std::intrinsics::fabsf64"
    "std::intrinsics::fadd_algebraic"
    "std::intrinsics::fadd_fast"
    "std::intrinsics::fdiv_algebraic"
    "std::intrinsics::fdiv_fast"
    "std::intrinsics::float_to_int_unchecked"
    "std::intrinsics::floorf32"
    "std::intrinsics::floorf64"
    "std::intrinsics::fmaf32"
    "std::intrinsics::fmaf64"
    "std::intrinsics::fmul_algebraic"
    "std::intrinsics::fmul_fast"
    "std::intrinsics::forget"
    "std::intrinsics::frem_algebraic"
    "std::intrinsics::frem_fast"
    "std::intrinsics::fsub_algebraic"
    "std::intrinsics::fsub_fast"
    "std::intrinsics::is_val_statically_known"
    "std::intrinsics::likely"
    "std::intrinsics::log10f32"
    "std::intrinsics::log10f64"
    "std::intrinsics::log2f32"
    "std::intrinsics::log2f64"
    "std::intrinsics::logf32"
    "std::intrinsics::logf64"
    "std::intrinsics::maxnumf32"
    "std::intrinsics::maxnumf64"
    "std::intrinsics::min_align_of"
    "std::intrinsics::min_align_of_val"
    "std::intrinsics::minnumf32"
    "std::intrinsics::minnumf64"
    "std::intrinsics::mir::Assume"
    "std::intrinsics::mir::Call"
    "std::intrinsics::mir::CastTransmute"
    "std::intrinsics::mir::Checked"
    "std::intrinsics::mir::CopyForDeref"
    "std::intrinsics::mir::Deinit"
    "std::intrinsics::mir::Discriminant"
    "std::intrinsics::mir::Drop"
    "std::intrinsics::mir::Field"
    "std::intrinsics::mir::Goto"
    "std::intrinsics::mir::Len"
    "std::intrinsics::mir::Move"
    "std::intrinsics::mir::Offset"
    "std::intrinsics::mir::PtrMetadata"
    "std::intrinsics::mir::Retag"
    "std::intrinsics::mir::Return"
    "std::intrinsics::mir::ReturnTo"
    "std::intrinsics::mir::SetDiscriminant"
    "std::intrinsics::mir::Static"
    "std::intrinsics::mir::StaticMut"
    "std::intrinsics::mir::StorageDead"
    "std::intrinsics::mir::StorageLive"
    "std::intrinsics::mir::Unreachable"
    "std::intrinsics::mir::UnwindCleanup"
    "std::intrinsics::mir::UnwindContinue"
    "std::intrinsics::mir::UnwindResume"
    "std::intrinsics::mir::UnwindTerminate"
    "std::intrinsics::mir::UnwindUnreachable"
    "std::intrinsics::mir::Variant"
    "std::intrinsics::mul_with_overflow"
    "std::intrinsics::nearbyintf32"
    "std::intrinsics::nearbyintf64"
    "std::intrinsics::needs_drop"
    "std::intrinsics::nontemporal_store"
    "std::intrinsics::offset"
    "std::intrinsics::powf32"
    "std::intrinsics::powf64"
    "std::intrinsics::powif128"
    "std::intrinsics::powif16"
    "std::intrinsics::powif32"
    "std::intrinsics::powif64"
    "std::intrinsics::pref_align_of"
    "std::intrinsics::prefetch_read_data"
    "std::intrinsics::prefetch_read_instruction"
    "std::intrinsics::prefetch_write_data"
    "std::intrinsics::prefetch_write_instruction"
    "std::intrinsics::ptr_guaranteed_cmp"
    "std::intrinsics::ptr_mask"
    "std::intrinsics::ptr_metadata"
    "std::intrinsics::ptr_offset_from"
    "std::intrinsics::ptr_offset_from_unsigned"
    "std::intrinsics::raw_eq"
    "std::intrinsics::read_via_copy"
    "std::intrinsics::rintf32"
    "std::intrinsics::rintf64"
    "std::intrinsics::rotate_left"
    "std::intrinsics::rotate_right"
    "std::intrinsics::roundevenf32"
    "std::intrinsics::roundevenf64"
    "std::intrinsics::roundf32"
    "std::intrinsics::roundf64"
    "std::intrinsics::rustc_peek"
    "std::intrinsics::saturating_add"
    "std::intrinsics::saturating_sub"
    "std::intrinsics::simd::simd_add"
    "std::intrinsics::simd::simd_and"
    "std::intrinsics::simd::simd_arith_offset"
    "std::intrinsics::simd::simd_as"
    "std::intrinsics::simd::simd_bitmask"
    "std::intrinsics::simd::simd_bitreverse"
    "std::intrinsics::simd::simd_bswap"
    "std::intrinsics::simd::simd_cast"
    "std::intrinsics::simd::simd_cast_ptr"
    "std::intrinsics::simd::simd_ceil"
    "std::intrinsics::simd::simd_ctlz"
    "std::intrinsics::simd::simd_ctpop"
    "std::intrinsics::simd::simd_cttz"
    "std::intrinsics::simd::simd_div"
    "std::intrinsics::simd::simd_eq"
    "std::intrinsics::simd::simd_expose_provenance"
    "std::intrinsics::simd::simd_extract"
    "std::intrinsics::simd::simd_fabs"
    "std::intrinsics::simd::simd_fcos"
    "std::intrinsics::simd::simd_fexp"
    "std::intrinsics::simd::simd_fexp2"
    "std::intrinsics::simd::simd_flog"
    "std::intrinsics::simd::simd_flog10"
    "std::intrinsics::simd::simd_flog2"
    "std::intrinsics::simd::simd_floor"
    "std::intrinsics::simd::simd_fma"
    "std::intrinsics::simd::simd_fmax"
    "std::intrinsics::simd::simd_fmin"
    "std::intrinsics::simd::simd_fsin"
    "std::intrinsics::simd::simd_fsqrt"
    "std::intrinsics::simd::simd_gather"
    "std::intrinsics::simd::simd_ge"
    "std::intrinsics::simd::simd_gt"
    "std::intrinsics::simd::simd_insert"
    "std::intrinsics::simd::simd_le"
    "std::intrinsics::simd::simd_lt"
    "std::intrinsics::simd::simd_masked_load"
    "std::intrinsics::simd::simd_masked_store"
    "std::intrinsics::simd::simd_mul"
    "std::intrinsics::simd::simd_ne"
    "std::intrinsics::simd::simd_neg"
    "std::intrinsics::simd::simd_or"
    "std::intrinsics::simd::simd_reduce_add_ordered"
    "std::intrinsics::simd::simd_reduce_add_unordered"
    "std::intrinsics::simd::simd_reduce_all"
    "std::intrinsics::simd::simd_reduce_and"
    "std::intrinsics::simd::simd_reduce_any"
    "std::intrinsics::simd::simd_reduce_max"
    "std::intrinsics::simd::simd_reduce_min"
    "std::intrinsics::simd::simd_reduce_mul_ordered"
    "std::intrinsics::simd::simd_reduce_mul_unordered"
    "std::intrinsics::simd::simd_reduce_or"
    "std::intrinsics::simd::simd_reduce_xor"
    "std::intrinsics::simd::simd_rem"
    "std::intrinsics::simd::simd_round"
    "std::intrinsics::simd::simd_saturating_add"
    "std::intrinsics::simd::simd_saturating_sub"
    "std::intrinsics::simd::simd_scatter"
    "std::intrinsics::simd::simd_select"
    "std::intrinsics::simd::simd_select_bitmask"
    "std::intrinsics::simd::simd_shl"
    "std::intrinsics::simd::simd_shr"
    "std::intrinsics::simd::simd_shuffle"
    "std::intrinsics::simd::simd_shuffle_generic"
    "std::intrinsics::simd::simd_sub"
    "std::intrinsics::simd::simd_trunc"
    "std::intrinsics::simd::simd_with_exposed_provenance"
    "std::intrinsics::simd::simd_xor"
    "std::intrinsics::sinf32"
    "std::intrinsics::sinf64"
    "std::intrinsics::size_of"
    "std::intrinsics::size_of_val"
    "std::intrinsics::sqrtf32"
    "std::intrinsics::sqrtf64"
    "std::intrinsics::sub_with_overflow"
    "std::intrinsics::three_way_compare"
    "std::intrinsics::transmute"
    "std::intrinsics::transmute_unchecked"
    "std::intrinsics::truncf32"
    "std::intrinsics::truncf64"
    "std::intrinsics::type_id"
    "std::intrinsics::type_name"
    "std::intrinsics::typed_swap"
    "std::intrinsics::ub_checks"
    "std::intrinsics::unaligned_volatile_load"
    "std::intrinsics::unaligned_volatile_store"
    "std::intrinsics::unchecked_add"
    "std::intrinsics::unchecked_div"
    "std::intrinsics::unchecked_mul"
    "std::intrinsics::unchecked_rem"
    "std::intrinsics::unchecked_shl"
    "std::intrinsics::unchecked_shr"
    "std::intrinsics::unchecked_sub"
    "std::intrinsics::unlikely"
    "std::intrinsics::unreachable"
    "std::intrinsics::variant_count"
    "std::intrinsics::volatile_copy_memory"
    "std::intrinsics::volatile_copy_nonoverlapping_memory"
    "std::intrinsics::volatile_load"
    "std::intrinsics::volatile_set_memory"
    "std::intrinsics::volatile_store"
    "std::intrinsics::vtable_align"
    "std::intrinsics::vtable_size"
    "std::intrinsics::wrapping_add"
    "std::intrinsics::wrapping_mul"
    "std::intrinsics::wrapping_sub"
    "std::intrinsics::write_bytes"
    "std::intrinsics::write_via_move"
    "std::io::copy"
    "std::io::empty"
    "std::io::read_to_string"
    "std::io::repeat"
    "std::io::sink"
    "std::io::stderr"
    "std::io::stdin"
    "std::io::stdout"
    "std::iter::chain"
    "std::iter::empty"
    "std::iter::from_coroutine"
    "std::iter::from_fn"
    "std::iter::once"
    "std::iter::once_with"
    "std::iter::repeat"
    "std::iter::repeat_n"
    "std::iter::repeat_with"
    "std::iter::successors"
    "std::iter::zip"
    "std::mem::align_of"
    "std::mem::align_of_val"
    "std::mem::align_of_val_raw"
    "std::mem::copy"
    "std::mem::discriminant"
    "std::mem::drop"
    "std::mem::forget"
    "std::mem::forget_unsized"
    "std::mem::min_align_of"
    "std::mem::min_align_of_val"
    "std::mem::needs_drop"
    "std::mem::replace"
    "std::mem::size_of"
    "std::mem::size_of_val"
    "std::mem::size_of_val_raw"
    "std::mem::swap"
    "std::mem::take"
    "std::mem::transmute"
    "std::mem::transmute_copy"
    "std::mem::uninitialized"
    "std::mem::variant_count"
    "std::mem::zeroed"
    "std::os::unix::fs::chown"
    "std::os::unix::fs::chroot"
    "std::os::unix::fs::fchown"
    "std::os::unix::fs::lchown"
    "std::os::unix::fs::symlink"
    "std::os::unix::process::parent_id"
    "std::os::wasi::fs::link"
    "std::os::wasi::fs::rename"
    "std::os::wasi::fs::symlink"
    "std::os::wasi::fs::symlink_path"
    "std::os::windows::fs::junction_point"
    "std::os::windows::fs::symlink_dir"
    "std::os::windows::fs::symlink_file"
    "std::panic::always_abort"
    "std::panic::catch_unwind"
    "std::panic::get_backtrace_style"
    "std::panic::panic_any"
    "std::panic::resume_unwind"
    "std::panic::set_backtrace_style"
    "std::panic::set_hook"
    "std::panic::take_hook"
    "std::panic::update_hook"
    "std::path::absolute"
    "std::path::is_separator"
    "std::process::abort"
    "std::process::exit"
    "std::process::id"
    "std::ptr::addr_eq"
    "std::ptr::copy"
    "std::ptr::copy_nonoverlapping"
    "std::ptr::dangling"
    "std::ptr::dangling_mut"
    "std::ptr::drop_in_place"
    "std::ptr::eq"
    "std::ptr::from_mut"
    "std::ptr::from_raw_parts"
    "std::ptr::from_raw_parts_mut"
    "std::ptr::from_ref"
    "std::ptr::hash"
    "std::ptr::metadata"
    "std::ptr::null"
    "std::ptr::null_mut"
    "std::ptr::read"
    "std::ptr::read_unaligned"
    "std::ptr::read_volatile"
    "std::ptr::replace"
    "std::ptr::slice_from_raw_parts"
    "std::ptr::slice_from_raw_parts_mut"
    "std::ptr::swap"
    "std::ptr::swap_nonoverlapping"
    "std::ptr::with_exposed_provenance"
    "std::ptr::with_exposed_provenance_mut"
    "std::ptr::without_provenance"
    "std::ptr::without_provenance_mut"
    "std::ptr::write"
    "std::ptr::write_bytes"
    "std::ptr::write_unaligned"
    "std::ptr::write_volatile"
    "std::slice::from_mut"
    "std::slice::from_mut_ptr_range"
    "std::slice::from_ptr_range"
    "std::slice::from_raw_parts"
    "std::slice::from_raw_parts_mut"
    "std::slice::from_ref"
    "std::slice::range"
    "std::slice::try_range"
    "std::str::from_boxed_utf8_unchecked"
    "std::str::from_raw_parts"
    "std::str::from_raw_parts_mut"
    "std::str::from_utf8"
    "std::str::from_utf8_mut"
    "std::str::from_utf8_unchecked"
    "std::str::from_utf8_unchecked_mut"
    "std::sync::atomic::compiler_fence"
    "std::sync::atomic::fence"
    "std::sync::atomic::spin_loop_hint"
    "std::sync::mpsc::channel"
    "std::sync::mpsc::sync_channel"
    "std::thread::available_parallelism"
    "std::thread::current"
    "std::thread::panicking"
    "std::thread::park"
    "std::thread::park_timeout"
    "std::thread::park_timeout_ms"
    "std::thread::scope"
    "std::thread::sleep"
    "std::thread::sleep_ms"
    "std::thread::sleep_until"
    "std::thread::spawn"
    "std::thread::yield_now"
    "std::alloc::LayoutErr"
    "std::ffi::c_char"
    "std::ffi::c_double"
    "std::ffi::c_float"
    "std::ffi::c_int"
    "std::ffi::c_long"
    "std::ffi::c_longlong"
    "std::ffi::c_schar"
    "std::ffi::c_short"
    "std::ffi::c_uchar"
    "std::ffi::c_uint"
    "std::ffi::c_ulong"
    "std::ffi::c_ulonglong"
    "std::ffi::c_ushort"
    "std::fmt::Result"
    "std::io::RawOsError"
    "std::io::Result"
    "std::num::NonZeroI128"
    "std::num::NonZeroI16"
    "std::num::NonZeroI32"
    "std::num::NonZeroI64"
    "std::num::NonZeroI8"
    "std::num::NonZeroIsize"
    "std::num::NonZeroU128"
    "std::num::NonZeroU16"
    "std::num::NonZeroU32"
    "std::num::NonZeroU64"
    "std::num::NonZeroU8"
    "std::num::NonZeroUsize"
    "std::os::fd::RawFd"
    "std::os::linux::raw::blkcnt_t"
    "std::os::linux::raw::blksize_t"
    "std::os::linux::raw::dev_t"
    "std::os::linux::raw::ino_t"
    "std::os::linux::raw::mode_t"
    "std::os::linux::raw::nlink_t"
    "std::os::linux::raw::off_t"
    "std::os::linux::raw::pthread_t"
    "std::os::linux::raw::time_t"
    "std::os::raw::c_char"
    "std::os::raw::c_double"
    "std::os::raw::c_float"
    "std::os::raw::c_int"
    "std::os::raw::c_long"
    "std::os::raw::c_longlong"
    "std::os::raw::c_schar"
    "std::os::raw::c_short"
    "std::os::raw::c_uchar"
    "std::os::raw::c_uint"
    "std::os::raw::c_ulong"
    "std::os::raw::c_ulonglong"
    "std::os::raw::c_ushort"
    "std::os::raw::c_void"
    "std::os::unix::raw::blkcnt_t"
    "std::os::unix::raw::blksize_t"
    "std::os::unix::raw::dev_t"
    "std::os::unix::raw::gid_t"
    "std::os::unix::raw::ino_t"
    "std::os::unix::raw::mode_t"
    "std::os::unix::raw::nlink_t"
    "std::os::unix::raw::off_t"
    "std::os::unix::raw::pid_t"
    "std::os::unix::raw::pthread_t"
    "std::os::unix::raw::time_t"
    "std::os::unix::raw::uid_t"
    "std::os::unix::thread::RawPthread"
    "std::os::windows::io::RawHandle"
    "std::os::windows::io::RawSocket"
    "std::os::windows::raw::HANDLE"
    "std::os::windows::raw::SOCKET"
    "std::simd::f32x1"
    "std::simd::f32x16"
    "std::simd::f32x2"
    "std::simd::f32x32"
    "std::simd::f32x4"
    "std::simd::f32x64"
    "std::simd::f32x8"
    "std::simd::f64x1"
    "std::simd::f64x16"
    "std::simd::f64x2"
    "std::simd::f64x32"
    "std::simd::f64x4"
    "std::simd::f64x64"
    "std::simd::f64x8"
    "std::simd::i16x1"
    "std::simd::i16x16"
    "std::simd::i16x2"
    "std::simd::i16x32"
    "std::simd::i16x4"
    "std::simd::i16x64"
    "std::simd::i16x8"
    "std::simd::i32x1"
    "std::simd::i32x16"
    "std::simd::i32x2"
    "std::simd::i32x32"
    "std::simd::i32x4"
    "std::simd::i32x64"
    "std::simd::i32x8"
    "std::simd::i64x1"
    "std::simd::i64x16"
    "std::simd::i64x2"
    "std::simd::i64x32"
    "std::simd::i64x4"
    "std::simd::i64x64"
    "std::simd::i64x8"
    "std::simd::i8x1"
    "std::simd::i8x16"
    "std::simd::i8x2"
    "std::simd::i8x32"
    "std::simd::i8x4"
    "std::simd::i8x64"
    "std::simd::i8x8"
    "std::simd::isizex1"
    "std::simd::isizex16"
    "std::simd::isizex2"
    "std::simd::isizex32"
    "std::simd::isizex4"
    "std::simd::isizex64"
    "std::simd::isizex8"
    "std::simd::mask16x1"
    "std::simd::mask16x16"
    "std::simd::mask16x2"
    "std::simd::mask16x32"
    "std::simd::mask16x4"
    "std::simd::mask16x64"
    "std::simd::mask16x8"
    "std::simd::mask32x1"
    "std::simd::mask32x16"
    "std::simd::mask32x2"
    "std::simd::mask32x32"
    "std::simd::mask32x4"
    "std::simd::mask32x64"
    "std::simd::mask32x8"
    "std::simd::mask64x1"
    "std::simd::mask64x16"
    "std::simd::mask64x2"
    "std::simd::mask64x32"
    "std::simd::mask64x4"
    "std::simd::mask64x64"
    "std::simd::mask64x8"
    "std::simd::mask8x1"
    "std::simd::mask8x16"
    "std::simd::mask8x2"
    "std::simd::mask8x32"
    "std::simd::mask8x4"
    "std::simd::mask8x64"
    "std::simd::mask8x8"
    "std::simd::masksizex1"
    "std::simd::masksizex16"
    "std::simd::masksizex2"
    "std::simd::masksizex32"
    "std::simd::masksizex4"
    "std::simd::masksizex64"
    "std::simd::masksizex8"
    "std::simd::prelude::f32x1"
    "std::simd::prelude::f32x16"
    "std::simd::prelude::f32x2"
    "std::simd::prelude::f32x32"
    "std::simd::prelude::f32x4"
    "std::simd::prelude::f32x64"
    "std::simd::prelude::f32x8"
    "std::simd::prelude::f64x1"
    "std::simd::prelude::f64x16"
    "std::simd::prelude::f64x2"
    "std::simd::prelude::f64x32"
    "std::simd::prelude::f64x4"
    "std::simd::prelude::f64x64"
    "std::simd::prelude::f64x8"
    "std::simd::prelude::i16x1"
    "std::simd::prelude::i16x16"
    "std::simd::prelude::i16x2"
    "std::simd::prelude::i16x32"
    "std::simd::prelude::i16x4"
    "std::simd::prelude::i16x64"
    "std::simd::prelude::i16x8"
    "std::simd::prelude::i32x1"
    "std::simd::prelude::i32x16"
    "std::simd::prelude::i32x2"
    "std::simd::prelude::i32x32"
    "std::simd::prelude::i32x4"
    "std::simd::prelude::i32x64"
    "std::simd::prelude::i32x8"
    "std::simd::prelude::i64x1"
    "std::simd::prelude::i64x16"
    "std::simd::prelude::i64x2"
    "std::simd::prelude::i64x32"
    "std::simd::prelude::i64x4"
    "std::simd::prelude::i64x64"
    "std::simd::prelude::i64x8"
    "std::simd::prelude::i8x1"
    "std::simd::prelude::i8x16"
    "std::simd::prelude::i8x2"
    "std::simd::prelude::i8x32"
    "std::simd::prelude::i8x4"
    "std::simd::prelude::i8x64"
    "std::simd::prelude::i8x8"
    "std::simd::prelude::isizex1"
    "std::simd::prelude::isizex16"
    "std::simd::prelude::isizex2"
    "std::simd::prelude::isizex32"
    "std::simd::prelude::isizex4"
    "std::simd::prelude::isizex64"
    "std::simd::prelude::isizex8"
    "std::simd::prelude::mask16x1"
    "std::simd::prelude::mask16x16"
    "std::simd::prelude::mask16x2"
    "std::simd::prelude::mask16x32"
    "std::simd::prelude::mask16x4"
    "std::simd::prelude::mask16x64"
    "std::simd::prelude::mask16x8"
    "std::simd::prelude::mask32x1"
    "std::simd::prelude::mask32x16"
    "std::simd::prelude::mask32x2"
    "std::simd::prelude::mask32x32"
    "std::simd::prelude::mask32x4"
    "std::simd::prelude::mask32x64"
    "std::simd::prelude::mask32x8"
    "std::simd::prelude::mask64x1"
    "std::simd::prelude::mask64x16"
    "std::simd::prelude::mask64x2"
    "std::simd::prelude::mask64x32"
    "std::simd::prelude::mask64x4"
    "std::simd::prelude::mask64x64"
    "std::simd::prelude::mask64x8"
    "std::simd::prelude::mask8x1"
    "std::simd::prelude::mask8x16"
    "std::simd::prelude::mask8x2"
    "std::simd::prelude::mask8x32"
    "std::simd::prelude::mask8x4"
    "std::simd::prelude::mask8x64"
    "std::simd::prelude::mask8x8"
    "std::simd::prelude::masksizex1"
    "std::simd::prelude::masksizex16"
    "std::simd::prelude::masksizex2"
    "std::simd::prelude::masksizex32"
    "std::simd::prelude::masksizex4"
    "std::simd::prelude::masksizex64"
    "std::simd::prelude::masksizex8"
    "std::simd::prelude::u16x1"
    "std::simd::prelude::u16x16"
    "std::simd::prelude::u16x2"
    "std::simd::prelude::u16x32"
    "std::simd::prelude::u16x4"
    "std::simd::prelude::u16x64"
    "std::simd::prelude::u16x8"
    "std::simd::prelude::u32x1"
    "std::simd::prelude::u32x16"
    "std::simd::prelude::u32x2"
    "std::simd::prelude::u32x32"
    "std::simd::prelude::u32x4"
    "std::simd::prelude::u32x64"
    "std::simd::prelude::u32x8"
    "std::simd::prelude::u64x1"
    "std::simd::prelude::u64x16"
    "std::simd::prelude::u64x2"
    "std::simd::prelude::u64x32"
    "std::simd::prelude::u64x4"
    "std::simd::prelude::u64x64"
    "std::simd::prelude::u64x8"
    "std::simd::prelude::u8x1"
    "std::simd::prelude::u8x16"
    "std::simd::prelude::u8x2"
    "std::simd::prelude::u8x32"
    "std::simd::prelude::u8x4"
    "std::simd::prelude::u8x64"
    "std::simd::prelude::u8x8"
    "std::simd::prelude::usizex1"
    "std::simd::prelude::usizex16"
    "std::simd::prelude::usizex2"
    "std::simd::prelude::usizex32"
    "std::simd::prelude::usizex4"
    "std::simd::prelude::usizex64"
    "std::simd::prelude::usizex8"
    "std::simd::u16x1"
    "std::simd::u16x16"
    "std::simd::u16x2"
    "std::simd::u16x32"
    "std::simd::u16x4"
    "std::simd::u16x64"
    "std::simd::u16x8"
    "std::simd::u32x1"
    "std::simd::u32x16"
    "std::simd::u32x2"
    "std::simd::u32x32"
    "std::simd::u32x4"
    "std::simd::u32x64"
    "std::simd::u32x8"
    "std::simd::u64x1"
    "std::simd::u64x16"
    "std::simd::u64x2"
    "std::simd::u64x32"
    "std::simd::u64x4"
    "std::simd::u64x64"
    "std::simd::u64x8"
    "std::simd::u8x1"
    "std::simd::u8x16"
    "std::simd::u8x2"
    "std::simd::u8x32"
    "std::simd::u8x4"
    "std::simd::u8x64"
    "std::simd::u8x8"
    "std::simd::usizex1"
    "std::simd::usizex16"
    "std::simd::usizex2"
    "std::simd::usizex32"
    "std::simd::usizex4"
    "std::simd::usizex64"
    "std::simd::usizex8"
    "std::string::ParseError"
    "std::sync::LockResult"
    "std::sync::TryLockResult"
    "std::thread::Result"
    "std::char::MAX"
    "std::char::REPLACEMENT_CHARACTER"
    "std::char::UNICODE_VERSION"
    "std::env::consts::ARCH"
    "std::env::consts::DLL_EXTENSION"
    "std::env::consts::DLL_PREFIX"
    "std::env::consts::DLL_SUFFIX"
    "std::env::consts::EXE_EXTENSION"
    "std::env::consts::EXE_SUFFIX"
    "std::env::consts::FAMILY"
    "std::env::consts::OS"
    "std::f128::consts::E"
    "std::f128::consts::EGAMMA"
    "std::f128::consts::FRAC_1_PI"
    "std::f128::consts::FRAC_1_SQRT_2"
    "std::f128::consts::FRAC_1_SQRT_3"
    "std::f128::consts::FRAC_1_SQRT_PI"
    "std::f128::consts::FRAC_2_PI"
    "std::f128::consts::FRAC_2_SQRT_PI"
    "std::f128::consts::FRAC_PI_2"
    "std::f128::consts::FRAC_PI_3"
    "std::f128::consts::FRAC_PI_4"
    "std::f128::consts::FRAC_PI_6"
    "std::f128::consts::FRAC_PI_8"
    "std::f128::consts::LN_10"
    "std::f128::consts::LN_2"
    "std::f128::consts::LOG10_2"
    "std::f128::consts::LOG10_E"
    "std::f128::consts::LOG2_10"
    "std::f128::consts::LOG2_E"
    "std::f128::consts::PHI"
    "std::f128::consts::PI"
    "std::f128::consts::SQRT_2"
    "std::f128::consts::SQRT_3"
    "std::f128::consts::TAU"
    "std::f16::consts::E"
    "std::f16::consts::EGAMMA"
    "std::f16::consts::FRAC_1_PI"
    "std::f16::consts::FRAC_1_SQRT_2"
    "std::f16::consts::FRAC_1_SQRT_3"
    "std::f16::consts::FRAC_1_SQRT_PI"
    "std::f16::consts::FRAC_2_PI"
    "std::f16::consts::FRAC_2_SQRT_PI"
    "std::f16::consts::FRAC_PI_2"
    "std::f16::consts::FRAC_PI_3"
    "std::f16::consts::FRAC_PI_4"
    "std::f16::consts::FRAC_PI_6"
    "std::f16::consts::FRAC_PI_8"
    "std::f16::consts::LN_10"
    "std::f16::consts::LN_2"
    "std::f16::consts::LOG10_2"
    "std::f16::consts::LOG10_E"
    "std::f16::consts::LOG2_10"
    "std::f16::consts::LOG2_E"
    "std::f16::consts::PHI"
    "std::f16::consts::PI"
    "std::f16::consts::SQRT_2"
    "std::f16::consts::SQRT_3"
    "std::f16::consts::TAU"
    "std::f32::DIGITS"
    "std::f32::EPSILON"
    "std::f32::INFINITY"
    "std::f32::MANTISSA_DIGITS"
    "std::f32::MAX"
    "std::f32::MAX_10_EXP"
    "std::f32::MAX_EXP"
    "std::f32::MIN"
    "std::f32::MIN_10_EXP"
    "std::f32::MIN_EXP"
    "std::f32::MIN_POSITIVE"
    "std::f32::NAN"
    "std::f32::NEG_INFINITY"
    "std::f32::RADIX"
    "std::f32::consts::E"
    "std::f32::consts::EGAMMA"
    "std::f32::consts::FRAC_1_PI"
    "std::f32::consts::FRAC_1_SQRT_2"
    "std::f32::consts::FRAC_1_SQRT_3"
    "std::f32::consts::FRAC_1_SQRT_PI"
    "std::f32::consts::FRAC_2_PI"
    "std::f32::consts::FRAC_2_SQRT_PI"
    "std::f32::consts::FRAC_PI_2"
    "std::f32::consts::FRAC_PI_3"
    "std::f32::consts::FRAC_PI_4"
    "std::f32::consts::FRAC_PI_6"
    "std::f32::consts::FRAC_PI_8"
    "std::f32::consts::LN_10"
    "std::f32::consts::LN_2"
    "std::f32::consts::LOG10_2"
    "std::f32::consts::LOG10_E"
    "std::f32::consts::LOG2_10"
    "std::f32::consts::LOG2_E"
    "std::f32::consts::PHI"
    "std::f32::consts::PI"
    "std::f32::consts::SQRT_2"
    "std::f32::consts::SQRT_3"
    "std::f32::consts::TAU"
    "std::f64::DIGITS"
    "std::f64::EPSILON"
    "std::f64::INFINITY"
    "std::f64::MANTISSA_DIGITS"
    "std::f64::MAX"
    "std::f64::MAX_10_EXP"
    "std::f64::MAX_EXP"
    "std::f64::MIN"
    "std::f64::MIN_10_EXP"
    "std::f64::MIN_EXP"
    "std::f64::MIN_POSITIVE"
    "std::f64::NAN"
    "std::f64::NEG_INFINITY"
    "std::f64::RADIX"
    "std::f64::consts::E"
    "std::f64::consts::EGAMMA"
    "std::f64::consts::FRAC_1_PI"
    "std::f64::consts::FRAC_1_SQRT_2"
    "std::f64::consts::FRAC_1_SQRT_3"
    "std::f64::consts::FRAC_1_SQRT_PI"
    "std::f64::consts::FRAC_2_PI"
    "std::f64::consts::FRAC_2_SQRT_PI"
    "std::f64::consts::FRAC_PI_2"
    "std::f64::consts::FRAC_PI_3"
    "std::f64::consts::FRAC_PI_4"
    "std::f64::consts::FRAC_PI_6"
    "std::f64::consts::FRAC_PI_8"
    "std::f64::consts::LN_10"
    "std::f64::consts::LN_2"
    "std::f64::consts::LOG10_2"
    "std::f64::consts::LOG10_E"
    "std::f64::consts::LOG2_10"
    "std::f64::consts::LOG2_E"
    "std::f64::consts::PHI"
    "std::f64::consts::PI"
    "std::f64::consts::SQRT_2"
    "std::f64::consts::SQRT_3"
    "std::f64::consts::TAU"
    "std::i128::MAX"
    "std::i128::MIN"
    "std::i16::MAX"
    "std::i16::MIN"
    "std::i32::MAX"
    "std::i32::MIN"
    "std::i64::MAX"
    "std::i64::MIN"
    "std::i8::MAX"
    "std::i8::MIN"
    "std::isize::MAX"
    "std::isize::MIN"
    "std::path::MAIN_SEPARATOR"
    "std::path::MAIN_SEPARATOR_STR"
    "std::sync::ONCE_INIT"
    "std::sync::atomic::ATOMIC_BOOL_INIT"
    "std::sync::atomic::ATOMIC_ISIZE_INIT"
    "std::sync::atomic::ATOMIC_USIZE_INIT"
    "std::time::UNIX_EPOCH"
    "std::u128::MAX"
    "std::u128::MIN"
    "std::u16::MAX"
    "std::u16::MIN"
    "std::u32::MAX"
    "std::u32::MIN"
    "std::u64::MAX"
    "std::u64::MIN"
    "std::u8::MAX"
    "std::u8::MIN"
    "std::usize::MAX"
    "std::usize::MIN")
  "std::A list of available topics in rust-docs.

Extracted by using 
   Array.from(document.querySelectorAll(
     '#main-content .all-items li')).map(li => li.innerText)")

(cl-defmethod rust-docs--get-file (topic)
  (with-work-buffer
    (unless (zerop (call-process "rustup" nil t nil "doc" "--path" topic))
      (error "rustup: %s" (buffer-string)))
    (expand-file-name
     (string-trim-right
      (buffer-substring-no-properties (point-min) (point-max))))))

(cl-defmethod rust-docs--get-url (topic)
  (concat
   (if (memq system-type '(ms-dos windows-nt))
       "file:///" "file://")
   (rust-docs--get-file topic)))

(defvar rust-docs-history nil
  "History of rust-docs.")

(cl-defmethod rust-docs--read-topic (prompt &optional initial)
  (completing-read prompt rust-docs-topics nil nil initial 'rust-docs-history))

(defvar rust-docs--base-path nil)

(defun rust-docs--base-path ()
  (or rust-docs--base-path
      (let ((index-file
	     (with-work-buffer
	       (call-process "rustup" nil t nil "doc" "--std" "--path")
	       (string-trim-right (buffer-substring-no-properties (point-min) (point-max))))))
	(setq rust-docs--base-path
	      (file-name-parent-directory
	       (file-name-parent-directory index-file))))))

(cl-defmethod rust-docs--url-p (url)
  (setq url (url-expand-file-name url))
  (or 
   (string-prefix-p (rust-docs--base-path) url)
   (string-prefix-p (concat "file://" (rust-docs--base-path)) url)))

(define-derived-mode rust-docs-mode special-mode "Rust-Docs"
  "Mode for displaying rust-docs."
  ;; New in Emacs 28.1
  (setq-local browse-url-handlers `((rust-docs--url-p . rust-docs--url-handler)
				    ,@browse-url-handlers))
  (setq-local buffer-undo-list nil
	      truncate-lines t))

(defcustom rust-docs-fontify-code-blocks t
  "If non-nil, fontify code blocks in the documentation."
  :type 'boolean)

(cl-defmethod rust-docs--shr-tag-pre (dom)
  "Fontify DOM as rust code block."
  (let ((start (point)))
    (if-let* ((mode (and rust-docs-fontify-code-blocks
			(or (and (fboundp 'rust-mode) 'rust-mode)
			    (and (fboundp 'rust-ts-mode) 'rust-ts-mode)))))
	(insert
	 (with-work-buffer
	   (shr-tag-pre dom)
	   (let ((inhibit-message t)
		 (message-log-max nil))
	     (ignore-errors (delay-mode-hooks (funcall mode)))
	     (font-lock-ensure))
	   (buffer-string)))
      (shr-tag-pre dom))
    (add-face-text-property start (point) 'rust-docs-code-block t)))

(cl-defmethod rust-docs--render (url)
  (with-current-buffer (get-buffer-create "*rust-docs*")
    (unless (derived-mode-p 'rust-docs-mode)
      (rust-docs-mode))
    (let ((inhibit-read-only t)
	  (shr-external-rendering-functions `((pre . rust-docs--shr-tag-pre)
					      ,@shr-external-rendering-functions))
	  (urlobj (url-generic-parse-url url)))
      (erase-buffer)
      (shr-insert-document
       (with-work-buffer
	 (url-insert-file-contents url)
	 (libxml-parse-html-region nil nil)))
      (set-buffer-modified-p nil)
      (setq url-current-object urlobj))
    (goto-char (point-min))
    (current-buffer)))

(cl-defmethod rust-docs--url-handler (url &rest _args)
  (let ((inhibit-read-only t))
    (rust-docs--render (url-expand-file-name url))))

;;;###autoload
(defun rust-docs-lookup (initial)
  "Lookup in rust doc.

INITIAL is the initial input of the minibuffer."
  (interactive "P")
  (let* ((topic (rust-docs--read-topic "Look up rust-docs: " initial))
	 (url (rust-docs--get-url topic)))
    (pop-to-buffer (rust-docs--render url))))

;;;###autoload
(defun rust-docs-lookup-symbol-at-point ()
  "Lookup the symbol at point in rust-docs."
  (interactive)
  (let ((symbol (thing-at-point 'symbol)))
    (rust-docs-lookup symbol)))

(provide 'rust-docs)
;;; rust-docs.el ends here
